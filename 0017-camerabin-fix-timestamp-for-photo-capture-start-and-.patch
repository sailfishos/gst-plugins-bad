From 1e924c103f9618dbd4be55fa15be6dca7f6032f9 Mon Sep 17 00:00:00 2001
From: Teemu Katajisto <ext-teemu.katajisto@nokia.com>
Date: Fri, 10 Sep 2010 14:38:25 +0300
Subject: [PATCH 17/23] camerabin: fix timestamp for photo-capture-start and
 photo-capture-stop

---
 gst/camerabin/gstcamerabin.c |   17 +++++++----------
 1 file changed, 7 insertions(+), 10 deletions(-)

diff --git a/gst/camerabin/gstcamerabin.c b/gst/camerabin/gstcamerabin.c
index 8bb5749..91e1db1 100644
--- a/gst/camerabin/gstcamerabin.c
+++ b/gst/camerabin/gstcamerabin.c
@@ -4328,7 +4328,6 @@ gst_camerabin_handle_message_func (GstBin * bin, GstMessage * msg)
   GstCameraBin *camera = GST_CAMERABIN (bin);
 
 #ifdef GST_TIMESTAMPS
-  const GstStructure *st;
   gint status;
 #endif
 
@@ -4397,15 +4396,8 @@ gst_camerabin_handle_message_func (GstBin * bin, GstMessage * msg)
             /* Re-format preview image if necessary and send to application */
             gst_camerabin_send_preview (camera, preview_image);
           }
-        }
-      }
-      break;
-    }
-    default:
 #ifdef GST_TIMESTAMPS
-      st = gst_message_get_structure (msg);
-      if (st) {
-        if (gst_structure_has_name (st, "photo-capture-start")) {
+        } else if (gst_structure_has_name (st, "photo-capture-start")) {
           CP ("CAMERABIN SOURCE CAPTURE START");
         } else if (gst_structure_has_name (st, "photo-capture-end")) {
           CP ("CAMERABIN SOURCE CAPTURE END");
@@ -4416,8 +4408,13 @@ gst_camerabin_handle_message_func (GstBin * bin, GstMessage * msg)
             }
           }
         }
-      }
+#else
+        }
 #endif
+      }
+      break;
+    }
+    default:
       break;
   }
   GST_BIN_CLASS (parent_class)->handle_message (bin, msg);
-- 
1.7.10.4

